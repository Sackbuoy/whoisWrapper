{"ast":null,"code":"'use strict';\n\nconst {\n  InvalidArgumentError,\n  NotSupportedError\n} = require('./errors');\n\nconst util = require('./util');\n\nconst assert = require('assert');\n\nconst kHandler = Symbol('handler');\nconst channels = {};\n\ntry {\n  const diagnosticsChannel = require('diagnostics_channel');\n\n  channels.create = diagnosticsChannel.channel('undici:request:create');\n  channels.bodySent = diagnosticsChannel.channel('undici:request:bodySent');\n  channels.headers = diagnosticsChannel.channel('undici:request:headers');\n  channels.trailers = diagnosticsChannel.channel('undici:request:trailers');\n  channels.error = diagnosticsChannel.channel('undici:request:error');\n} catch {\n  channels.create = {\n    hasSubscribers: false\n  };\n  channels.bodySent = {\n    hasSubscribers: false\n  };\n  channels.headers = {\n    hasSubscribers: false\n  };\n  channels.trailers = {\n    hasSubscribers: false\n  };\n  channels.error = {\n    hasSubscribers: false\n  };\n}\n\nclass Request {\n  constructor(origin, _ref, handler) {\n    let {\n      path,\n      method,\n      body,\n      headers,\n      idempotent,\n      blocking,\n      upgrade,\n      headersTimeout,\n      bodyTimeout\n    } = _ref;\n\n    if (typeof path !== 'string') {\n      throw new InvalidArgumentError('path must be a string');\n    } else if (path[0] !== '/' && !(path.startsWith('http://') || path.startsWith('https://'))) {\n      throw new InvalidArgumentError('path must be an absolute URL or start with a slash');\n    }\n\n    if (typeof method !== 'string') {\n      throw new InvalidArgumentError('method must be a string');\n    }\n\n    if (upgrade && typeof upgrade !== 'string') {\n      throw new InvalidArgumentError('upgrade must be a string');\n    }\n\n    if (headersTimeout != null && (!Number.isFinite(headersTimeout) || headersTimeout < 0)) {\n      throw new InvalidArgumentError('invalid headersTimeout');\n    }\n\n    if (bodyTimeout != null && (!Number.isFinite(bodyTimeout) || bodyTimeout < 0)) {\n      throw new InvalidArgumentError('invalid bodyTimeout');\n    }\n\n    this.headersTimeout = headersTimeout;\n    this.bodyTimeout = bodyTimeout;\n    this.method = method;\n\n    if (body == null) {\n      this.body = null;\n    } else if (util.isStream(body)) {\n      this.body = body;\n    } else if (body instanceof DataView) {\n      // TODO: Why is DataView special?\n      this.body = body.buffer.byteLength ? Buffer.from(body.buffer) : null;\n    } else if (body instanceof ArrayBuffer || ArrayBuffer.isView(body)) {\n      this.body = body.byteLength ? Buffer.from(body) : null;\n    } else if (util.isBuffer(body)) {\n      this.body = body.byteLength ? body : null;\n    } else if (typeof body === 'string') {\n      this.body = body.length ? Buffer.from(body) : null;\n    } else if (util.isIterable(body) || util.isBlob(body)) {\n      this.body = body;\n    } else {\n      throw new InvalidArgumentError('body must be a string, a Buffer, a Readable stream, an iterable, or an async iterable');\n    }\n\n    this.completed = false;\n    this.aborted = false;\n    this.upgrade = upgrade || null;\n    this.path = path;\n    this.origin = origin;\n    this.idempotent = idempotent == null ? method === 'HEAD' || method === 'GET' : idempotent;\n    this.blocking = blocking == null ? false : blocking;\n    this.host = null;\n    this.contentLength = null;\n    this.contentType = null;\n    this.headers = '';\n\n    if (Array.isArray(headers)) {\n      if (headers.length % 2 !== 0) {\n        throw new InvalidArgumentError('headers array must be even');\n      }\n\n      for (let i = 0; i < headers.length; i += 2) {\n        processHeader(this, headers[i], headers[i + 1]);\n      }\n    } else if (headers && typeof headers === 'object') {\n      const keys = Object.keys(headers);\n\n      for (let i = 0; i < keys.length; i++) {\n        const key = keys[i];\n        processHeader(this, key, headers[key]);\n      }\n    } else if (headers != null) {\n      throw new InvalidArgumentError('headers must be an object or an array');\n    }\n\n    if (util.isBlob(body) && this.contentType == null) {\n      this.contentType = body.type;\n      this.headers += `content-type: ${body.type}\\r\\n`;\n    }\n\n    util.validateHandler(handler, method, upgrade);\n    this.servername = util.getServerName(this.host);\n    this[kHandler] = handler;\n\n    if (channels.create.hasSubscribers) {\n      channels.create.publish({\n        request: this\n      });\n    }\n  }\n\n  onBodySent(chunk) {\n    if (this[kHandler].onBodySent) {\n      try {\n        this[kHandler].onBodySent(chunk);\n      } catch (err) {\n        this.onError(err);\n      }\n    }\n  }\n\n  onRequestSent() {\n    if (channels.bodySent.hasSubscribers) {\n      channels.bodySent.publish({\n        request: this\n      });\n    }\n  }\n\n  onConnect(abort) {\n    assert(!this.aborted);\n    assert(!this.completed);\n    return this[kHandler].onConnect(abort);\n  }\n\n  onHeaders(statusCode, headers, resume, statusText) {\n    assert(!this.aborted);\n    assert(!this.completed);\n\n    if (channels.headers.hasSubscribers) {\n      channels.headers.publish({\n        request: this,\n        response: {\n          statusCode,\n          headers,\n          statusText\n        }\n      });\n    }\n\n    return this[kHandler].onHeaders(statusCode, headers, resume, statusText);\n  }\n\n  onData(chunk) {\n    assert(!this.aborted);\n    assert(!this.completed);\n    return this[kHandler].onData(chunk);\n  }\n\n  onUpgrade(statusCode, headers, socket) {\n    assert(!this.aborted);\n    assert(!this.completed);\n    return this[kHandler].onUpgrade(statusCode, headers, socket);\n  }\n\n  onComplete(trailers) {\n    assert(!this.aborted);\n    this.completed = true;\n\n    if (channels.trailers.hasSubscribers) {\n      channels.trailers.publish({\n        request: this,\n        trailers\n      });\n    }\n\n    return this[kHandler].onComplete(trailers);\n  }\n\n  onError(error) {\n    if (channels.error.hasSubscribers) {\n      channels.error.publish({\n        request: this,\n        error\n      });\n    }\n\n    if (this.aborted) {\n      return;\n    }\n\n    this.aborted = true;\n    return this[kHandler].onError(error);\n  }\n\n  addHeader(key, value) {\n    processHeader(this, key, value);\n    return this;\n  }\n\n}\n\nfunction processHeader(request, key, val) {\n  if (val && typeof val === 'object') {\n    throw new InvalidArgumentError(`invalid ${key} header`);\n  } else if (val === undefined) {\n    return;\n  }\n\n  if (request.host === null && key.length === 4 && key.toLowerCase() === 'host') {\n    // Consumed by Client\n    request.host = val;\n  } else if (request.contentLength === null && key.length === 14 && key.toLowerCase() === 'content-length') {\n    request.contentLength = parseInt(val, 10);\n\n    if (!Number.isFinite(request.contentLength)) {\n      throw new InvalidArgumentError('invalid content-length header');\n    }\n  } else if (request.contentType === null && key.length === 12 && key.toLowerCase() === 'content-type') {\n    request.contentType = val;\n    request.headers += `${key}: ${val}\\r\\n`;\n  } else if (key.length === 17 && key.toLowerCase() === 'transfer-encoding') {\n    throw new InvalidArgumentError('invalid transfer-encoding header');\n  } else if (key.length === 10 && key.toLowerCase() === 'connection') {\n    throw new InvalidArgumentError('invalid connection header');\n  } else if (key.length === 10 && key.toLowerCase() === 'keep-alive') {\n    throw new InvalidArgumentError('invalid keep-alive header');\n  } else if (key.length === 7 && key.toLowerCase() === 'upgrade') {\n    throw new InvalidArgumentError('invalid upgrade header');\n  } else if (key.length === 6 && key.toLowerCase() === 'expect') {\n    throw new NotSupportedError('expect header not supported');\n  } else {\n    request.headers += `${key}: ${val}\\r\\n`;\n  }\n}\n\nmodule.exports = Request;","map":{"version":3,"sources":["/home/cameron/Dev/whoisWrapper/ui/node_modules/undici/lib/core/request.js"],"names":["InvalidArgumentError","NotSupportedError","require","util","assert","kHandler","Symbol","channels","diagnosticsChannel","create","channel","bodySent","headers","trailers","error","hasSubscribers","Request","constructor","origin","handler","path","method","body","idempotent","blocking","upgrade","headersTimeout","bodyTimeout","startsWith","Number","isFinite","isStream","DataView","buffer","byteLength","Buffer","from","ArrayBuffer","isView","isBuffer","length","isIterable","isBlob","completed","aborted","host","contentLength","contentType","Array","isArray","i","processHeader","keys","Object","key","type","validateHandler","servername","getServerName","publish","request","onBodySent","chunk","err","onError","onRequestSent","onConnect","abort","onHeaders","statusCode","resume","statusText","response","onData","onUpgrade","socket","onComplete","addHeader","value","val","undefined","toLowerCase","parseInt","module","exports"],"mappings":"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","sourcesContent":["'use strict'\n\nconst {\n  InvalidArgumentError,\n  NotSupportedError\n} = require('./errors')\nconst util = require('./util')\nconst assert = require('assert')\n\nconst kHandler = Symbol('handler')\n\nconst channels = {}\n\ntry {\n  const diagnosticsChannel = require('diagnostics_channel')\n  channels.create = diagnosticsChannel.channel('undici:request:create')\n  channels.bodySent = diagnosticsChannel.channel('undici:request:bodySent')\n  channels.headers = diagnosticsChannel.channel('undici:request:headers')\n  channels.trailers = diagnosticsChannel.channel('undici:request:trailers')\n  channels.error = diagnosticsChannel.channel('undici:request:error')\n} catch {\n  channels.create = { hasSubscribers: false }\n  channels.bodySent = { hasSubscribers: false }\n  channels.headers = { hasSubscribers: false }\n  channels.trailers = { hasSubscribers: false }\n  channels.error = { hasSubscribers: false }\n}\n\nclass Request {\n  constructor (origin, {\n    path,\n    method,\n    body,\n    headers,\n    idempotent,\n    blocking,\n    upgrade,\n    headersTimeout,\n    bodyTimeout\n  }, handler) {\n    if (typeof path !== 'string') {\n      throw new InvalidArgumentError('path must be a string')\n    } else if (path[0] !== '/' && !(path.startsWith('http://') || path.startsWith('https://'))) {\n      throw new InvalidArgumentError('path must be an absolute URL or start with a slash')\n    }\n\n    if (typeof method !== 'string') {\n      throw new InvalidArgumentError('method must be a string')\n    }\n\n    if (upgrade && typeof upgrade !== 'string') {\n      throw new InvalidArgumentError('upgrade must be a string')\n    }\n\n    if (headersTimeout != null && (!Number.isFinite(headersTimeout) || headersTimeout < 0)) {\n      throw new InvalidArgumentError('invalid headersTimeout')\n    }\n\n    if (bodyTimeout != null && (!Number.isFinite(bodyTimeout) || bodyTimeout < 0)) {\n      throw new InvalidArgumentError('invalid bodyTimeout')\n    }\n\n    this.headersTimeout = headersTimeout\n\n    this.bodyTimeout = bodyTimeout\n\n    this.method = method\n\n    if (body == null) {\n      this.body = null\n    } else if (util.isStream(body)) {\n      this.body = body\n    } else if (body instanceof DataView) {\n      // TODO: Why is DataView special?\n      this.body = body.buffer.byteLength ? Buffer.from(body.buffer) : null\n    } else if (body instanceof ArrayBuffer || ArrayBuffer.isView(body)) {\n      this.body = body.byteLength ? Buffer.from(body) : null\n    } else if (util.isBuffer(body)) {\n      this.body = body.byteLength ? body : null\n    } else if (typeof body === 'string') {\n      this.body = body.length ? Buffer.from(body) : null\n    } else if (util.isIterable(body) || util.isBlob(body)) {\n      this.body = body\n    } else {\n      throw new InvalidArgumentError('body must be a string, a Buffer, a Readable stream, an iterable, or an async iterable')\n    }\n\n    this.completed = false\n\n    this.aborted = false\n\n    this.upgrade = upgrade || null\n\n    this.path = path\n\n    this.origin = origin\n\n    this.idempotent = idempotent == null\n      ? method === 'HEAD' || method === 'GET'\n      : idempotent\n\n    this.blocking = blocking == null ? false : blocking\n\n    this.host = null\n\n    this.contentLength = null\n\n    this.contentType = null\n\n    this.headers = ''\n\n    if (Array.isArray(headers)) {\n      if (headers.length % 2 !== 0) {\n        throw new InvalidArgumentError('headers array must be even')\n      }\n      for (let i = 0; i < headers.length; i += 2) {\n        processHeader(this, headers[i], headers[i + 1])\n      }\n    } else if (headers && typeof headers === 'object') {\n      const keys = Object.keys(headers)\n      for (let i = 0; i < keys.length; i++) {\n        const key = keys[i]\n        processHeader(this, key, headers[key])\n      }\n    } else if (headers != null) {\n      throw new InvalidArgumentError('headers must be an object or an array')\n    }\n\n    if (util.isBlob(body) && this.contentType == null) {\n      this.contentType = body.type\n      this.headers += `content-type: ${body.type}\\r\\n`\n    }\n\n    util.validateHandler(handler, method, upgrade)\n\n    this.servername = util.getServerName(this.host)\n\n    this[kHandler] = handler\n\n    if (channels.create.hasSubscribers) {\n      channels.create.publish({ request: this })\n    }\n  }\n\n  onBodySent (chunk) {\n    if (this[kHandler].onBodySent) {\n      try {\n        this[kHandler].onBodySent(chunk)\n      } catch (err) {\n        this.onError(err)\n      }\n    }\n  }\n\n  onRequestSent () {\n    if (channels.bodySent.hasSubscribers) {\n      channels.bodySent.publish({ request: this })\n    }\n  }\n\n  onConnect (abort) {\n    assert(!this.aborted)\n    assert(!this.completed)\n\n    return this[kHandler].onConnect(abort)\n  }\n\n  onHeaders (statusCode, headers, resume, statusText) {\n    assert(!this.aborted)\n    assert(!this.completed)\n\n    if (channels.headers.hasSubscribers) {\n      channels.headers.publish({ request: this, response: { statusCode, headers, statusText } })\n    }\n\n    return this[kHandler].onHeaders(statusCode, headers, resume, statusText)\n  }\n\n  onData (chunk) {\n    assert(!this.aborted)\n    assert(!this.completed)\n\n    return this[kHandler].onData(chunk)\n  }\n\n  onUpgrade (statusCode, headers, socket) {\n    assert(!this.aborted)\n    assert(!this.completed)\n\n    return this[kHandler].onUpgrade(statusCode, headers, socket)\n  }\n\n  onComplete (trailers) {\n    assert(!this.aborted)\n\n    this.completed = true\n    if (channels.trailers.hasSubscribers) {\n      channels.trailers.publish({ request: this, trailers })\n    }\n    return this[kHandler].onComplete(trailers)\n  }\n\n  onError (error) {\n    if (channels.error.hasSubscribers) {\n      channels.error.publish({ request: this, error })\n    }\n\n    if (this.aborted) {\n      return\n    }\n    this.aborted = true\n    return this[kHandler].onError(error)\n  }\n\n  addHeader (key, value) {\n    processHeader(this, key, value)\n    return this\n  }\n}\n\nfunction processHeader (request, key, val) {\n  if (val && typeof val === 'object') {\n    throw new InvalidArgumentError(`invalid ${key} header`)\n  } else if (val === undefined) {\n    return\n  }\n\n  if (\n    request.host === null &&\n    key.length === 4 &&\n    key.toLowerCase() === 'host'\n  ) {\n    // Consumed by Client\n    request.host = val\n  } else if (\n    request.contentLength === null &&\n    key.length === 14 &&\n    key.toLowerCase() === 'content-length'\n  ) {\n    request.contentLength = parseInt(val, 10)\n    if (!Number.isFinite(request.contentLength)) {\n      throw new InvalidArgumentError('invalid content-length header')\n    }\n  } else if (\n    request.contentType === null &&\n    key.length === 12 &&\n    key.toLowerCase() === 'content-type'\n  ) {\n    request.contentType = val\n    request.headers += `${key}: ${val}\\r\\n`\n  } else if (\n    key.length === 17 &&\n    key.toLowerCase() === 'transfer-encoding'\n  ) {\n    throw new InvalidArgumentError('invalid transfer-encoding header')\n  } else if (\n    key.length === 10 &&\n    key.toLowerCase() === 'connection'\n  ) {\n    throw new InvalidArgumentError('invalid connection header')\n  } else if (\n    key.length === 10 &&\n    key.toLowerCase() === 'keep-alive'\n  ) {\n    throw new InvalidArgumentError('invalid keep-alive header')\n  } else if (\n    key.length === 7 &&\n    key.toLowerCase() === 'upgrade'\n  ) {\n    throw new InvalidArgumentError('invalid upgrade header')\n  } else if (\n    key.length === 6 &&\n    key.toLowerCase() === 'expect'\n  ) {\n    throw new NotSupportedError('expect header not supported')\n  } else {\n    request.headers += `${key}: ${val}\\r\\n`\n  }\n}\n\nmodule.exports = Request\n"]},"metadata":{},"sourceType":"script"}